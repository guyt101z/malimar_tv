<%
filter_params = Hash.new
unless @category.content_type.blank?
    filter_params[:content_type] = @category.content_type
end

unless @category.content_quality.blank?
    filter_params[:content_quality] = @category.content_quality
end

filter_params[:free] = @category.free
filter_params[:web] = true

if @category.item_type == 'shows'
    all_items = Show.where(filter_params).order(name: :asc)
    filtered_items = Array.new

    unless @category.genre.blank?
        all_items.each do |item|
            filtered_items.push(item) if item.matches_genre?(@category.genre)
        end
    else
        filtered_items = all_items
    end
elsif @category.item_type == 'movies'
    all_items = Movie.where(filter_params.except(:content_type)).order(name: :asc)
    filtered_items = Array.new

    unless @category.genre.blank?
        all_items.each do |item|
            filtered_items.push(item) if item.matches_genre?(@category.genre)
        end
    else
        filtered_items = all_items
    end
else
    all_items = Channel.where(filter_params).order(name: :asc)
    filtered_items = Array.new

    unless @category.genre.blank?
        all_items.each do |item|
            filtered_items.push(item) if item.matches_genre?(@category.genre)
        end
    else
        filtered_items = all_items
    end
end
%>
<div class="splash">
    <div class="container">
        <div class="figure hidden-xs hidden-sm"><%= image_tag "figure-04.png" %></div>
        <h3>Works on Xbox 360®,  Playstation 3®, HDTV/Blue-ray™ player, Android™ Devices, Roku®, Ipad® or computer</h3>
        <div class="fz12">* Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod.</div>
    </div>
</div><!--splash-->
<div class="content">
    <div class="container">
        <% if filtered_items.any? %>
            <div class="panel panel-custom">
                  <div class="panel-heading">
                    <div class="icon-left"><span class="glyphicon glyphicon-heart"></span></div>
                    <h3><%= @category.name %></h3>
                </div>
                  <div class="panel-body">
                    <div class="row row0">
                        <% filtered_items.each do |item| %>
                            <div class="col-sm-4 col-md-2">
                                <div class="channel">
                                    <a href="<%= item.watch_url %>">
                                        <% if item.content_quality == 'HD' %><div class="ribbon"><%= image_tag "ribbon-hd.png" %></div><% end %>
                                        <div class="channel-img"><%= image_tag item.image_url(:front_page), class: "grayscale" %></div>
                                        <h4><%= item.name %></h4>
                                    </a>
                                </div>
                            </div>
                        <% end %>
                    </div>
                  </div>
            </div><!--pannel-->
        <% end %>
    </div>
</div>
